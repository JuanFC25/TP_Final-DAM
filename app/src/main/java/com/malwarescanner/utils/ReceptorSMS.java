package com.malwarescanner.utils;

import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.preference.PreferenceManager;
import android.provider.Telephony;
import android.util.Log;

import androidx.core.app.NotificationCompat;
import androidx.core.app.NotificationManagerCompat;

import com.malwarescanner.ListaSMS;
import com.malwarescanner.R;

public class ReceptorSMS extends BroadcastReceiver {

    @Override
    public void onReceive(Context context, Intent intent) {
        Log.i("SERVICIO", "ESTOY EN LA ACTIVIDAD PRINCIPAL ");
        //modificarRecyclerView();

        if (intent.getAction().equals(Telephony.Sms.Intents.SMS_RECEIVED_ACTION)) {
            Log.i("MENSAJE", "ESTOY ACA ");
        }
        SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(context);
        boolean recibirSMS = pref.getBoolean("permitirNotificacionesMensaje", false);
        if(recibirSMS){
            Intent destino = new Intent(context, ListaSMS.class);
            destino.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);
            PendingIntent pendingIntent = PendingIntent.getActivity(context, 0, destino, 0);

            NotificationCompat.Builder mBuilder =
                    new NotificationCompat.Builder(context, "25")
                            .setSmallIcon(R.mipmap.logo_foreground)
                            .setContentTitle("ATENCIÃ“N")
                            .setContentText("A llegado un mensaje, pulse aqui para analizarlo.")
                            .setPriority(NotificationCompat.PRIORITY_DEFAULT)
                            .setContentIntent(pendingIntent)
                            .setAutoCancel(true);

            NotificationManagerCompat notificationManager =
                    NotificationManagerCompat.from(context);
            notificationManager.notify(25, mBuilder.build());

        }

    }
}
